<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.com">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Performance Management</title>

    <link href="../../../static/css/bootstrap.min.css" rel="stylesheet"
          th:href="@{/css/bootstrap.min.css}">
    <link href="../../../static/font-awesome/css/font-awesome.css" rel="stylesheet"
          th:href="@{/font-awesome/css/font-awesome.css}">

    <link href="../../../static/css/animate.css" rel="stylesheet"
          th:href="@{/css/animate.css}">
    <link href="../../../static/css/style.css" rel="stylesheet"
          th:href="@{/css/style.css}">
    <link href="../../../static/css/plugins/select2/select2.min.css" rel="stylesheet"
          th:href="@{/css/plugins/select2/select2.min.css}">
    <link href="../../../static/css/plugins/select2/select2-bootstrap4.min.css" rel="stylesheet"
          th:href="@{/css/plugins/select2/select2-bootstrap4.min.css}">

    <script>
        function submitScorecardForApproval(){
            document.getElementById('scorecardForm').submit();
        }
    </script>
    <style>
        .show{
            display: block;
        }
        .hide{
            display: none;
        }
    </style>
</head>

<body class="mini-navbar">

<div id="wrapper">
    <div th:replace="fragments/template :: side-menu"></div>

    <div id="page-wrapper" class="gray-bg">

        <div th:replace="fragments/template :: top-navbar"></div>
        <div th:replace="fragments/template :: page-heading"></div>
        <div th:replace="fragments/template :: alerts"></div>

        <div class="wrapper wrapper-content animated fadeInRight ecommerce">
            <div class="ibox-content m-b-sm border-bottom">
                    <div class="row table-responsive">
                        <table class="table">
                            <tbody>
                               <tr>
                                   <th colspan="6">
                                       <form th:action="@{/scorecards/select-gear}" method="post">
                                           <div class="row">
                                               <div class="col-4">
                                                   <label>Select Gear</label>
                                               </div>
                                               <div class="col-4">
                                                   <select class="form-control select2_demo_1" name="gearId">
                                                       <option th:each="gear: ${gears}" th:value="${gear.id}" th:text="${gear.name}"></option>
                                                   </select>
                                               </div>
                                               <div class="col-4">
                                                   <input type="hidden" name="scorecardId" th:value="${scorecard.id}">
                                                   <button type="submit" class="btn btn-primary btn-sm">save</button>
                                               </div>
                                           </div>

                                       </form>
                                   </th>
                               </tr>

                               <div th:each="gear : ${selectedGears}">
                                   <tr>
                                       <th colspan="7" style="text-align: center">
                                           <label>Gear: <span th:text="${gear.name}"></span></label>
                                       </th>
                                   </tr>
                                   <tr>
                                       <th colspan="2">Objectives</th>
                                       <th colspan="5"></th>
                                   </tr>
                                   <div th:each="goal : ${gear.goals}">
                                       <tr>
                                           <th>
                                               <b>Goal:</b>
                                               <span th:text="${goal.name}"></span>
                                           </th>
                                           <th>Output</th>
                                           <th>Performance Indicator</th>
                                           <th>Unit</th>
                                           <th>Base Line</th>
                                           <th>Target</th>
                                           <th>Weight</th>
                                           <th></th>
                                       </tr>
                                       <tr th:each="target, stat : ${targetsList}" th:if="${target?.output?.outcome?.goal == goal}" th:with="newOutcome=${(stat.index == 0) || (targetsList[stat.index - 1].output.outcome.name != target.output.outcome.name)},
                                                                                                 newOutput=${newOutcome || (stat.index == 0) || (targetsList[stat.index - 1].output.name != target.output.name)}">
                                            <td th:if="${newOutcome}" th:text="${target.output?.outcome?.name}" th:rowspan="${targetsList.?[output?.outcome == #root.target.output?.outcome].size()}"></td>
                                            <td th:if="${newOutput}" th:text="${target.output?.name}" th:rowspan="${targetsList.?[output.name == #root.target.output.name].size()}"></td>
                                            <td th:text="${target.measure}"></td>
                                            <td th:text="${target.unit}"></td>
                                            <td th:text="${target.baseTarget}"></td>
                                            <td th:text="${target.normalTarget}"></td>
                                            <td th:if="${newOutput}" th:text="${target.output?.weight +'%'}" th:rowspan="${targetsList.?[output.name == #root.target.output.name].size()}"></td>
                                            <td>
                                                <a data-toggle="modal" th:data-target="'#addModal'+ ${stat.index}"><i class="fa fa-lg fa-plus" style="color: #175ea8"></i></a>
                                                <a data-toggle="modal" th:data-target="'#editModal'+ ${stat.index}"><i class="fa fa-lg fa-pencil-square" style="color: rebeccapurple"></i></a>
                                                <a data-toggle="modal" th:data-target="'#deleteModal'+ ${stat.index}"><i class="fa fa-lg fa-trash" style="color: red"></i></a>
                                            </td>

                                           <div class="modal fade" th:id="'editModal'+ ${stat.index}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                               <div class="modal-dialog modal-lg" role="document">
                                                   <div class="modal-content">
                                                       <div class="modal-header">
                                                           <h4 class="modal-title">Update Target [<span th:text="${target.output?.name}" class="text-success"></span>]</h4>
                                                           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                               <span aria-hidden="true">&times;</span>
                                                           </button>
                                                       </div>
                                                       <form method="post" th:object="${target}" th:action="@{/scorecards/save-target}">
                                                           <div class="modal-body">
                                                               <div class="row">
                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Outcome</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <select name="outcome" class="form-control select2_demo_1" style="width: 100%">
                                                                                       <option th:value="${target.output?.outcome?.id}" th:text="${target.output?.outcome?.name}" selected></option>
                                                                                       <option th:each="outcome :${goal.outcomes}" th:value="${outcome.id}" th:text="${outcome.name}">Option
                                                                                           1
                                                                                       </option>
                                                                                   </select>

                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Output</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="text" name="name" class="form-control" th:value="${target.output?.name}" style="width: 100%">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Performance Indicator</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="text" name="measure" class="form-control" th:value="${target.measure}">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Unit of Measurement</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <select name="unit" class="form-control select2_demo_1">
                                                                                       <option th:value="${target.unit}" th:text="${target.unit}" selected></option>
                                                                                       <option>#</option>
                                                                                       <option>$</option>
                                                                                       <option>%</option>
                                                                                       <option>L</option>
                                                                                   </select>
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12" >
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Base Target</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="number" step="any" name="baseTarget" class="form-control" th:value="${target.baseTarget}">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12" >
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Target</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="number" step="any" name="normalTarget" class="form-control" th:value="${target.normalTarget}">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>

                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Allocated Weight</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="number" step="any" min="0.1" max="100" name="allocatedWeight" class="form-control" th:value="${target.allocatedWeight}">
                                                                                   <input type="hidden" th:value="${target.id}" name="targetId">
                                                                                   <input type="hidden" th:value="${target.output?.id}" name="outputId">
                                                                                   <input type="hidden" th:value="${target.output?.outcome?.id}" name="outcomeId">
                                                                                   <input type="hidden" th:value="${target.output?.scorecard.id}" name="scorecardId">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                               </div>
                                                           </div>
                                                           <div class="modal-footer">
                                                               <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                               <button type="submit" class="btn btn-primary">Save changes</button>
                                                           </div>
                                                       </form>
                                                   </div>
                                               </div>
                                           </div>
                                           <div class="modal fade" th:id="'addModal'+ ${stat.index}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                               <div class="modal-dialog modal-lg" role="document">
                                                   <div class="modal-content">
                                                       <div class="modal-header">
                                                           <h4 class="modal-title">Add Another Target to Goal [<span th:text="${target.output?.name}" class="text-success"></span>]</h4>
                                                           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                               <span aria-hidden="true">&times;</span>
                                                           </button>
                                                       </div>
                                                       <form method="post" th:object="${target}" th:action="@{/scorecards/save-target-to-existing-goal}">
                                                           <div class="modal-body">
                                                               <div class="row">
                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Output</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <select name="output" class="form-control select2_demo_1" style="width: 100%">
                                                                                       <option th:value="${target.output.id}" th:text="${target.output?.name}" selected></option>
                                                                                   </select>
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Performance Indicator</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="text" name="measure" class="form-control">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Unit of Measurement</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <select name="unit" class="form-control select2_demo_1">
                                                                                       <option th:value="${target.unit}" th:text="${target.unit}" selected></option>
                                                                                       <option>#</option>
                                                                                       <option>$</option>
                                                                                       <option>%</option>
                                                                                       <option>L</option>
                                                                                   </select>
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>

                                                                   <div class="col-sm-12" >
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Base Target</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="number" step="any" name="baseTarget" class="form-control">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                                   <div class="col-sm-12" >
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Target</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="number" step="any" name="normalTarget" class="form-control">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>

                                                                   <div class="col-sm-12">
                                                                       <div class="form-group row">
                                                                           <label class="col-form-label col-lg-4">Allocated Weight</label>
                                                                           <div class="col-lg-8">
                                                                               <div class="input-group m-b">
                                                                                   <input type="number" step="any" min="0.1" max="100" name="allocatedWeight" class="form-control">
                                                                                   <input type="hidden" th:value="${target.output?.scorecard}" name="scorecard">
                                                                                   <input type="hidden" th:value="${target.output?.outcome.id}" name="outcome">
                                                                               </div>
                                                                           </div>
                                                                       </div>
                                                                   </div>
                                                               </div>
                                                           </div>
                                                           <div class="modal-footer">
                                                               <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                               <button type="submit" class="btn btn-primary">Save New Measure</button>
                                                           </div>
                                                       </form>
                                                   </div>
                                               </div>
                                           </div>

                                           <div class="modal fade" th:id="'deleteModal'+ ${stat.index}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                               <div class="modal-dialog" role="document">
                                                   <div class="modal-content">
                                                       <div class="modal-header">
                                                           <h5 class="modal-title">Delete Target</h5>
                                                           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                               <span aria-hidden="true">&times;</span>
                                                           </button>
                                                       </div>
                                                       <form method="post" th:object="${target}" th:action="@{/scorecards/delete-target}">
                                                           <div class="modal-body">
                                                               <div class="row">
                                                                   <div class="col-12">
                                                                       <h5 class="text-danger"> Are you sure you want to delete this goal/Target?</h5>
                                                                   </div>
                                                                   <div class="col-12">
                                                                       <h3 th:text="${target.measure}"></h3>
                                                                   </div>
                                                                   <input type="hidden" th:value="${target.id}" name="id">
                                                               </div>
                                                           </div>
                                                           <div class="modal-footer">
                                                               <button type="button" class="btn btn-waring" data-dismiss="modal">Cancel</button>
                                                               <button type="submit" class="btn btn-danger">Yes Delete</button>
                                                           </div>
                                                       </form>
                                                   </div>
                                               </div>
                                           </div>
                                       </tr>
                                       <form th:if="${totalAllocatedWeight != 100.0}" th:action="@{/scorecards/save-output-target}" method="post" th:object="${outputWrapper}">
                                           <tr>
                                               <td>
                                                   <select name="outcomeId" class="select2_demo_1">
                                                       <option th:each="outcome: ${goal.outcomes}" th:value="${outcome.id}" th:text="${outcome.name}"></option>
                                                   </select>
                                               </td>
                                               <td>
                                                   <textarea class="form-control" name="name" rows="2"></textarea>
                                               </td>
                                               <td>
                                                   <textarea class="form-control" name="measure" rows="2"></textarea>
                                               </td>
                                               <td>
                                                   <select class="form-control select2_demo_1" name="unit">
                                                       <option>#</option>
                                                       <option>$</option>
                                                       <option>%</option>
                                                       <option>L</option>
                                                   </select>
                                               </td>
                                               <td>
                                                   <input type="number" name="baseTarget" style="width: 7em">
                                               </td>
                                               <td>
                                                   <input type="number" name="normalTarget" style="width: 7em">
                                               </td>
                                               <td>
                                                   <input type="number" step="any" min="0.1" max="100" name="allocatedWeight" style="width: 6em">
                                               </td>
                                               <td>
                                                   <input type="hidden" name="scorecardId" th:value="${id}">
                                                   <button class="btn btn-sm btn-success" type="submit" >Save</button>
                                               </td>
                                           </tr>
                                       </form>

                                   </div>
                               </div>
                                <div>
                                    <tr>
                                        <th colspan="6"></th>
                                        <th>
                                            <h4 th:if="${totalAllocatedWeight == 100.0}" class="text-green" th:text="${totalAllocatedWeight} + '%'"></h4>
                                            <h4 th:unless="${totalAllocatedWeight == 100.0}" class="text-danger" th:text="${totalAllocatedWeight} + '%'"></h4>
                                        </th>
                                        <th colspan="2"></th>
                                    </tr>
                                </div>
                            </tbody>
                        </table>

                    </div>

            </div>

            <div class="form-group row">
                <div class="col-lg-4">
                    <input type="hidden" name="scorecardId" th:value="${id}">
                </div>
                <div class="col-lg-8" th:if="${totalAllocatedWeight == 100.0}">
                    <a th:href="@{/scorecards}" class="btn btn-success" type="button">Save For Later</a>
                    <button class="btn btn-success" th:if="${scorecard.approvalStatus == 'NEW'}" type="button" onclick="submitScorecardForApproval()">Submit for Approval</button>
                    <button class="btn btn-success" th:if="${scorecard.approvalStatus == 'REJECTED_BY_SUPERVISOR'}" type="button" onclick="submitScorecardForApproval()">Re-Submit for Approval</button>
                </div>
                <div class="col-lg-8" th:if="${totalAllocatedWeight != 100.0}">
                    <a th:href="@{/scorecards}" class="btn btn-success" type="button">Save For Later</a>
                    <button class="btn btn-secondary" type="button" disabled>Submit for Approval</button>
                </div>
            </div>

            <form th:action="@{/scorecards/submit-scorecard-for-approval}" id="scorecardForm" method="post" th:object="${scorecard}">
                <input type="hidden" name="id" th:value="${id}">
            </form>

        </div>
        <div th:replace="fragments/template :: footer"></div>

    </div>
</div>



<!-- Mainly scripts -->
<script src="../../../static/js/jquery-3.6.0.min.js"
        th:src="@{/js/jquery-3.6.0.min.js}"></script>
<script src="../../../static/js/popper.min.js"
        th:src="@{/js/popper.min.js}"></script>
<script src="../../../static./js/bootstrap.js"
        th:src="@{/js/bootstrap.js}"></script>
<script src="../../../static/js/plugins/metisMenu/jquery.metisMenu.js"
        th:src="@{/js/plugins/metisMenu/jquery.metisMenu.js}"></script>
<script src="../../../static/js/plugins/select2/select2.full.min.js"
        th:src="@{/js/plugins/select2/select2.full.min.js}"></script>


<!-- Custom and plugin javascript -->
<script src="../../../static/js/inspinia.js"
        th:src="@{/js/inspinia.js}"></script>
<script src="../../../static/js/plugins/pace/pace.min.js"
        th:src="@{/js/plugins/pace/pace.min.js}"></script>

<script>

    $(document).ready(function(){
        $('.select2_demo_1').select2({

        });
    })
    $(document).ready(function(){
        $('.myselect').select2({
          tags: true
        });
    })
    $(document).on('select2:open', () => {
        document.querySelector('.select2-search__field').focus();
    });
</script>

</body>

</html>
